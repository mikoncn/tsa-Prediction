# TSA 预测模型特征深度解析字典

# Deep Dive Feature Dictionary

本文档详细拆解了 TSA 客流预测系统中三大模型（Main, Sniper, Challenger）所使用的特征工程逻辑、业务影响原理及差异化策略。

---

## 1. 三大模型架构对比 (Model Comparison)

我们采用了“专家组合”策略，不同模型通过不同的特征视角观察数据。

| 模型代号           | 核心算法             | 角色定位       | 特征策略                                                                         | 优势                                                                                      |
| :----------------- | :------------------- | :------------- | :------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------- |
| **Main (XGBoost)** | XGBoost Regressor    | **战术指挥官** | **业务规则优先**。使用了极其详尽的“专家特征”（节假日距离、淡季修正、春假窗口）。 | 擅长捕捉人类已知的复杂规律（如“节前三天必涨”）。                                          |
| **Sniper (JIT)**   | XGBoost (Time-Aware) | **特种狙击手** | **时效性优先**。在 Main 的基础上，独占 **`flight_current`** (实时航班) 特征。    | 能根据“今天天上飞了多少架飞机”实时修正预测，对突发天气/调度改变反应最快。                 |
| **Challenger**     | LightGBM             | **基准对照组** | **纯数据驱动**。只使用基础的时序特征（Lags）和简单日历，不包含复杂的业务规则。   | 纯粹的统计学视角。如果 Main 模型“想多了”（过拟合），Challenger 会胜出，起到风控兜底作用。 |

---

## 2. 详细特征工程 (Detailed Feature Engineering)

以下是影响模型决策的核心因子。

### A. 节假日体系 (Holiday System) -> 影响方向：📈 大幅提升

这也是我们最复杂的特征组，专门应对美国的假期迁徙潮。

| 特征名       | 字段名                    | 深度逻辑                                                                                                                                                                                                          | 适用模型                              |
| :----------- | :------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------ |
| **节日距离** | `days_to_nearest_holiday` | **[核心] 连续变量**。计算距离最近的“12 大节日”（含 Good Friday）的天数。<br>**负数**(-3)：节前 3 天，出行高峰。<br>**正数**(+2)：节后 2 天，返程高峰。<br>**Clamping**：超过 +/-15 天被统一截断，聚焦“黄金两周”。 | ✅ Main<br>✅ Sniper<br>❌ Challenger |
| **节日当天** | `is_holiday`              | **[基础] 0/1 变量**。当天是否为法定假日。                                                                                                                                                                         | All Models                            |

> **12 大节日白名单**: New Year, MLK, Presidents' (Ski), Good Friday (Easter), Memorial, Juneteenth, Independence, Labor, Columbus (Fall), Veterans, Thanksgiving, Christmas.

### B. 航班运力 (Flight Capacity) -> 影响方向：📈 正相关

航班量是客流的“先行指标”。甚至可以说，TSA 安检人数本质上就是“坐飞机的人数”。

| 特征名       | 字段名           | 深度逻辑                                                                                                | 适用模型                                         |
| :----------- | :--------------- | :------------------------------------------------------------------------------------------------------ | :----------------------------------------------- |
| **实时航班** | `flight_current` | **[王牌]** 预测当日（T+0 或 T+1）实际降落的航班数。Sniper 模型甚至会在数据不足时触发 **API 现场抓取**。 | ❌ Main<br>✅ **Sniper** (独占)<br>❌ Challenger |
| **昨日航班** | `flight_lag_1`   | 昨日的航班总量。用于捕捉短期运力趋势。                                                                  | ✅ Main<br>❌ Sniper<br>❌ Challenger            |
| **七日均线** | `flight_ma_7`    | 过去 7 天的平均航班量。代表基础运力水平（Baseload）。                                                   | ✅ Main<br>❌ Sniper<br>✅ Challenger            |

### C. 气象与业务 (Weather & Business) -> 影响方向：📉 负相关 / 特定调整

捕获由于天气或由于特定商业习惯导致的客流波动。

| 特征名         | 字段名                | 深度逻辑                                                                                                              | 适用模型                              |
| :------------- | :-------------------- | :-------------------------------------------------------------------------------------------------------------------- | :------------------------------------ |
| **气象指数**   | `weather_index`       | **[负向]** 综合 Top 10 机场的恶劣天气（雪/暴雨/风）。**指数越高，预测值越低**（模型学习到了航班取消带来的客流坍塌）。 | ✅ Main<br>✅ Sniper<br>✅ Challenger |
| **昨日气象**   | `weather_lag_1`       | **[反弹]** 昨天的天气指数。当“昨差今好”时，模型会预测出**报复性反弹**（改签积压释放）。                               | ✅ Main<br>✅ Sniper<br>❌ Challenger |
| **淡季工作日** | `is_off_peak_workday` | **[负向] 精准打击**。专门标记 1,2,9,10 月的周二/周三。模型看到此标会自动下调预测，解决“一月中旬虚高”问题。            | ✅ Main<br>✅ Sniper<br>❌ Challenger |
| **春假**       | `is_spring_break`     | **[正向]** 标记 3-4 月的非节日周末。                                                                                  | ✅ Main<br>✅ Sniper<br>❌ Challenger |
| **长周末**     | `is_long_weekend`     | **[正向]** 标记周一或周五的节日（法定连休）。专门区分“孤立假期”和“连休假期”的爆发力差异。                             | ✅ Main<br>✅ Sniper<br>❌ Challenger |

### D. 时序基石 (Time Series Lags) -> 影响方向：⚓ 锚定基准

所有模型都依赖历史数据来寻找今天的坐标。

| 特征名       | 字段名    | 深度逻辑                                                                                                                                       | 适用模型                              |
| :----------- | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------ |
| **Lag-7**    | `lag_7`   | **周度锚点**。上周今天的客流。决定了今天的基础量级（例如周五就是比周二多）。                                                                   | All Models                            |
| **Lag-Year** | `lag_364` | **混合锚点 (Hybrid)**。通常使用 `shift(364)` 对齐星期几；但对于**固定日期节日** (如圣诞)，强制使用 `shift(365)` 对齐日期，消除“日历漂移”噪音。 | ✅ Main<br>✅ Sniper<br>❌ Challenger |

---

## 3. 影响机制总结 (Impact Mechanism)

当模型预测 **2026 年 1 月 19 日 (MLK Day)** 时，内部即时演算过程如下：

1.  **Challenger (LightGBM)**:

    - 👀 看到 `lag_7` (上周一) 有 220 万人。
    - 👀 看到 `is_holiday=1`。
    - 🤖 **判断**：基于 lag_7 稍微往上加一点。 -> **预测: 230 万** (容易低估，因为它不懂 MLK 具体有多猛)。

2.  **Main (XGBoost)**:

    - 🧠 看到 `days_to_nearest_holiday = 0` (正日)。
    - 🧠 看到 `days_to_nearest_holiday` 在过去三天分别是 -1, -2, -3 (形成了冲刺曲线)。
    - 🧠 看到 `is_off_peak_workday = 0` (虽然是 1 月，但今天是节日，不属于淡季)。
    - 🤖 **判断**：这是一个典型的节日尖峰，权重拉满。 -> **预测: 255 万**。

3.  **Sniper (XGBoost JIT)**:
    - 🛰️ **扫描天空**：通过 OpenSky 发现今天全美计划降落 24,000 架次航班（平时只有 21,000）。
    - 🤖 **判断**：Main 模型预测 255 万，但我看到飞机量爆了，比平时多 15%。我要在 Main 的基础上再加码。 -> **预测: 262 万**。

---

**总结**：
您的系统已经从简单的线性外推，进化到了具备**多维感知能力**的智能系统。

- **Main** 懂业务逻辑。
- **Sniper** 懂实时路况。
- **Challenger** 负责兜底防飞。
