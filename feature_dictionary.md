# TSA 预测模型特征深度解析字典

# Deep Dive Feature Dictionary

本文档详细拆解了 TSA 客流预测系统中三大模型（Main, Sniper, Challenger）所使用的特征工程逻辑、业务影响原理及差异化策略。

---

## 1. 三大模型架构对比 (Model Comparison)

我们采用了“专家组合”策略，不同模型通过不同的特征视角观察数据。

| 模型代号            | 核心算法           | 角色定位       | 特征策略                                                             | 优势                                                                      |
| :------------------ | :----------------- | :------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------ |
| **Main (Classic)**  | XGBoost Refressor  | **基准稳压器** | **业务规律优先**。使用了滞后特征 (Lag-7) 和基础假日逻辑。            | 擅长捕捉常规波动，提供可靠的基础流量预测。                                |
| **Shadow (Cancel)** | Poly-Regression    | **前哨侦察兵** | **非线性天气感应**。核心特征为 **`max_snow_sq`**。                   | 专门预测航班取消率，为 Hybrid 提示极致暴雨/雪的风险信号。                 |
| **Hybrid (V6.1)**   | XGBoost + Protocol | **战术总指挥** | **全维度融合**。集成影子模型输出 + **线性插值熔断** + **补位逻辑**。 | 极致的抗压能力。在 Jan 25 的大停航中精准补位，在 1月26日 实现了平滑误差。 |

---

## 2. 详细特征工程 (Detailed Feature Engineering)

以下是影响模型决策的核心因子。

### A. 影子雷达指标 (Shadow Metrics) -> 影响方向：📉 负相关

影子模型先行判断“飞得成吗”，主模型根据其信号进行“降维打击”。

| 特征名         | 字段名                  | 深度逻辑                                                                                                    |
| :------------- | :---------------------- | :---------------------------------------------------------------------------------------------------------- |
| **预测取消率** | `predicted_cancel_rate` | **[王牌]** 影子模型根据全美气象站二阶雪量 (`max_snow_sq`) 算出的预期取消概率。**>15% 即视为重大灾变信号。** |
| **平方雪暴**   | `max_snow_sq`           | 影子模型内部特征。对降雪进行平方处理，放大极端降雪对停航的非线性杀伤力。                                    |

### B. 节假日与业务 (Holiday & Business) -> 影响方向：📈 大幅提升

| 特征名       | 字段名            | 深度逻辑                                                                                                   |
| :----------- | :---------------- | :--------------------------------------------------------------------------------------------------------- |
| **距离节日** | `days_to_holiday` | 应用 T-3 到 T+3 的动态修正，捕捉迁徙窗口。                                                                 |
| **报复反弹** | `revenge_index`   | **[正向]** 自动计算过去 3 天由于天气导致的客流“压抑量”，在天气转好后第一天强制提升预测值，模拟“改签拥堵”。 |
| **淡季修正** | `is_off_peak_jan` | 专门针对 1 月中旬（元旦后）的低迷期进行常态化减权，防止由于去年同期的高基数导致预测虚高。                  |

### C. 熔断与平滑 (Protocol Engine) -> 核心保护机制

| 机制名         | 逻辑公式                     | 业务价值                                                                                          |
| :------------- | :--------------------------- | :------------------------------------------------------------------------------------------------ | ------------------------------------- |
| **线性插值**   | `1.0 - (Index - 10) * 0.02`  | **[平滑]** 消除阶梯裂缝。让 Index 15 对应 -10%，Index 19 对应 -18%。                              |
| **动态补位 B** | `min(Pred, Baseline * Mult)` | **[护航]** 解决“双重惩罚”。如果影子模型已经把预测降下来了，外层熔断只起“兜底”作用，不再二次切割。 |
| **春假**       | `is_spring_break`            | **[正向]** 标记 3-4 月的非节日周末。                                                              | ✅ Main<br>✅ Sniper<br>❌ Challenger |
| **长周末**     | `is_long_weekend`            | **[正向]** 标记周一或周五的节日（法定连休）。专门区分“孤立假期”和“连休假期”的爆发力差异。         | ✅ Main<br>✅ Sniper<br>❌ Challenger |

### D. 时序基石 (Time Series Lags) -> 影响方向：⚓ 锚定基准

所有模型都依赖历史数据来寻找今天的坐标。

| 特征名       | 字段名    | 深度逻辑                                                                                                                                       | 适用模型                              |
| :----------- | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------ |
| **Lag-7**    | `lag_7`   | **周度锚点**。上周今天的客流。决定了今天的基础量级（例如周五就是比周二多）。                                                                   | All Models                            |
| **Lag-Year** | `lag_364` | **混合锚点 (Hybrid)**。通常使用 `shift(364)` 对齐星期几；但对于**固定日期节日** (如圣诞)，强制使用 `shift(365)` 对齐日期，消除“日历漂移”噪音。 | ✅ Main<br>✅ Sniper<br>❌ Challenger |

---

## 3. 影响机制总结 (Impact Mechanism)

当模型预测 **2026 年 1 月 19 日 (MLK Day)** 时，内部即时演算过程如下：

1.  **Challenger (LightGBM)**:
    - 👀 看到 `lag_7` (上周一) 有 220 万人。
    - 👀 看到 `is_holiday=1`。
    - 🤖 **判断**：基于 lag_7 稍微往上加一点。 -> **预测: 230 万** (容易低估，因为它不懂 MLK 具体有多猛)。

2.  **Main (XGBoost)**:
    - 🧠 看到 `days_to_nearest_holiday = 0` (正日)。
    - 🧠 看到 `days_to_nearest_holiday` 在过去三天分别是 -1, -2, -3 (形成了冲刺曲线)。
    - 🧠 看到 `is_off_peak_workday = 0` (虽然是 1 月，但今天是节日，不属于淡季)。
    - 🤖 **判断**：这是一个典型的节日尖峰，权重拉满。 -> **预测: 255 万**。

3.  **Sniper (XGBoost JIT)**:
    - 🛰️ **扫描天空**：通过 OpenSky 发现今天全美计划降落 24,000 架次航班（平时只有 21,000）。
    - 🤖 **判断**：Main 模型预测 255 万，但我看到飞机量爆了，比平时多 15%。我要在 Main 的基础上再加码。 -> **预测: 262 万**。

---

**总结**：
您的系统已经从简单的线性外推，进化到了具备**多维感知能力**的智能系统。

- **Main** 懂业务逻辑。
- **Sniper** 懂实时路况。
- **Challenger** 负责兜底防飞。
