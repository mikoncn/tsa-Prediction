# TSA å…¨ç¾èˆªç©ºå®¢æµé«˜ç²¾åº¦åˆ†æç³»ç»Ÿ (Mikon AI Scout Edition)

> **Governance by Data, For the Prediction.**

æœ¬é¡¹ç›®æ˜¯ä¸€å¥—é›†**è‡ªåŠ¨åŒ–æ•°æ®é‡‡é›†**ã€**äº¤äº’å¼å¯è§†åŒ–**ä¸**é«˜ç»´åº¦ç‰¹å¾å·¥ç¨‹**äºä¸€ä½“çš„èˆªç©ºå®¢æµåˆ†æç³»ç»Ÿã€‚å®ƒä¸“ä¸ºæ•æ‰â€œé»‘å¤©é¹…â€äº‹ä»¶ï¼ˆå¦‚æç«¯å¤©æ°”ã€çªå‘ç–«æƒ…ï¼‰åŠå¤æ‚èŠ‚å‡æ—¥æ•ˆåº”è€Œè®¾è®¡ï¼Œä¸º Prophet/XGBoost ç­‰é¢„æµ‹æ¨¡å‹æä¾›é«˜è´¨é‡çš„â€œç‡ƒæ–™â€ã€‚

---

## ğŸ—ï¸ æ¶æ„å…¨æ™¯

ç³»ç»Ÿé‡‡ç”¨ **ETL (Extract, Transform, Load)** æ¶æ„ï¼Œæ•°æ®æµå‘æ¸…æ™°ï¼š

```mermaid
graph LR
    A[TSA å®˜ç½‘] -->|Scraper| B(SQLite ä¸»æ•°æ®åº“)
    C[Open-Meteo æ°”è±¡å±€] -->|API| D(æ°”è±¡ç‰¹å¾è¡¨)
    E[Holidays åº“ + ç®—æ³•] -->|Logic| F(èŠ‚å‡æ—¥ç‰¹å¾è¡¨)
    B --> G{Merge Engine}
    D --> G
    F --> G
    G -->|Left Join| H[traffic_full å®½è¡¨]
    H -->|API| I[Flask åç«¯]
    I -->|JSON| J[å‰ç«¯äº¤äº’çœ‹æ¿]
```

## ğŸ§© æ ¸å¿ƒç®—æ³•è¯¦è§£ (The Secret Sauce)

è¿™æ˜¯æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒç«äº‰åŠ›æ‰€åœ¨ã€‚æˆ‘ä»¬ä¸åªæ˜¯ç®€å•çš„ç½—åˆ—æ•°æ®ï¼Œè€Œæ˜¯æ³¨å…¥äº†æ·±åº¦ä¸šåŠ¡é€»è¾‘ã€‚

### 1. å¤šæ¢çº½ç†”æ–­æ°”è±¡æ¨¡å‹ (Hub Meltdown Model)

ä¼ ç»Ÿæ¨¡å‹åªçœ‹å•ä¸€æœºåœºï¼Œæ— æ³•ç†è§£å…¨ç¾èˆªç©ºç½‘çš„**è¿é”ååº”**ã€‚æˆ‘ä»¬è®¾è®¡äº†ç”± 5 å¤§æ¢çº½ï¼ˆATL, ORD, DFW, DEN, JFKï¼‰ç»„æˆçš„ç†”æ–­æœºåˆ¶ã€‚

- **ç›‘æµ‹æŒ‡æ ‡**: ç§¯é›ª (`Snowfall > 1.0cm`), å¼ºé£ (`Windspeed > 29.0km/h`), æš´é›¨ (`Rain > 20mm`).
- **åç‚¹åˆ¤å®š (Bad Hub)**: å•ä¸ªæœºåœºè‹¥è§¦å‘ä¸Šè¿°ä»»ä¸€é˜ˆå€¼ï¼Œå¾— **3-5 åˆ†**ï¼Œæ ‡è®°ä¸ºåç‚¹ã€‚
- **ç³»ç»Ÿç†”æ–­å…¬å¼**:
  $$ Final Score = \sum (Hub Scores) + Penalty $$
  - **Penalty è§„åˆ™**:
    - è‹¥ **2 ä¸ª** æ¢çº½åŒæ—¶æ²¦é™·: **+10 åˆ†** (ä¸¥é‡æ‹¥å µ)
    - è‹¥ **3 ä¸ªåŠä»¥ä¸Š** æ¢çº½æ²¦é™·: **+20 åˆ†** (ç³»ç»Ÿç†”æ–­/Meltdown)

> **å®æˆ˜æ¡ˆä¾‹**: 2022 å¹´ 12 æœˆ 22 æ—¥â€œç‚¸å¼¹æ°”æ—‹â€æœŸé—´ï¼Œç³»ç»Ÿæ£€æµ‹åˆ° 5 å¤§æ¢çº½å…¨å†›è¦†æ²¡ï¼ŒåŸºç¡€åˆ† 16 åˆ† + ç†”æ–­åˆ† 20 åˆ† = **36 åˆ†**ã€‚æ¨¡å‹å‡†ç¡®è¯†åˆ«å‡ºè¿™æ˜¯ç¾éš¾çº§çš„ä¸€å¤©ã€‚

### 2. å¤æ´»èŠ‚ä¼˜å…ˆç­–ç•¥ (Easter Priority Patch)

`holidays.US` åº“å¤©ç„¶ç¼ºå¤±éè”é‚¦å‡æ—¥çš„å¤æ´»èŠ‚ï¼Œä½†å®ƒæ˜¯èˆªç©ºå‡ºè¡Œçš„ç»å¯¹é«˜å³°ã€‚æˆ‘ä»¬å®æ–½äº†**å¼ºæ³¨å…¥é€»è¾‘**ï¼š

- **è®¡ç®—**: ä½¿ç”¨ `dateutil.easter` åŠ¨æ€è®¡ç®—æ¯å¹´å¤æ´»èŠ‚æ—¥æœŸã€‚
- **çª—å£**:
  - **Good Friday** (-2 å¤©)
  - **Holy Saturday** (-1 å¤©) [æ–°å¢]
  - **Easter Sunday** (0 å¤©)
  - **Easter Monday** (+1 å¤©)
- **ä¼˜å…ˆçº§**: æƒé‡è®¾ä¸º Tier 2ï¼Œç›´æ¥å†™å…¥ `is_holiday`ï¼Œå¼ºåˆ¶è¦†ç›–ã€‚

### 3. æ˜¥å‡å¯å‘å¼ç®—æ³• (Spring Break Heuristics)

æ˜¥å‡æ²¡æœ‰å›ºå®šæ—¥æœŸï¼Œä½†æœ‰è§„å¾‹å¯å¾ªã€‚æˆ‘ä»¬é‡‡ç”¨**æ’é™¤æ³•**å®šä¹‰æ˜¥å‡ï¼Œé¿å…ä¸ç¡®å®šçš„èŠ‚æ—¥å†²çªï¼š

```python
if (Month in [3, 4]) AND (Is_Weekend) AND (Not Holiday):
    is_spring_break = 1
else:
    0
```

> **æ•ˆæœ**: æ—¢æ•æ‰åˆ°äº†å¤§å­¦ç”Ÿæ˜¥å‡å¸¦æ¥çš„å‘¨æœ«å®¢æµé«˜å³°ï¼Œåˆä¸ä¼šå¹²æ‰°å¤æ´»èŠ‚ç­‰æ­£æ—¥å­çš„æƒé‡ã€‚

### 4. è¶…çº§ç¢—æ•ˆåº” (Super Bowl Algorithm)

æ¯å¹´ 2 æœˆçš„é‡ç£…ä½“è‚²èµ›äº‹ï¼Œå¼•å‘å·¨å¤§çš„éå…¸å‹è¿å¾™ã€‚

- **å®šä½**: æ¯å¹´ 2 æœˆçš„ç¬¬ 2 ä¸ªæ˜ŸæœŸæ—¥ã€‚
- **çª—å£**: Super Bowl Sunday + Post-SB Monday (å›æµæ—¥)ã€‚
- **åŠ¨ä½œ**: å¼ºåˆ¶è®¾ä¸º Tier 2 èŠ‚æ—¥ï¼Œè¦†ç›–å…¶ä»–ç‰¹å¾ã€‚

---

## ğŸ› ï¸ é¡¹ç›®ç»“æ„

- `build_tsa_db.py`: **çˆ¬è™«**. æ™ºèƒ½è¯†åˆ« TSA é¡µé¢ç»“æ„ï¼Œå¢é‡æ›´æ–°æ•°æ®ã€‚
- `get_weather_features.py`: **æ°”è±¡ç«™**. æŠ“å–å†å²å­˜æ¡£åŠæœªæ¥ 15 å¤©é¢„æŠ¥ï¼Œè®¡ç®—ç†”æ–­æŒ‡æ•°ã€‚
- `add_features.py`: **æ—¥å†**. ç”Ÿæˆ Tier 1/2/3 åˆ†çº§è”é‚¦å‡æ—¥ç‰¹å¾ã€‚
- `merge_db.py`: **æ€»è£…**. åŸºäºå…¨é‡æ—¶é—´è½´ (Timeline Strategy) ç”Ÿæˆ `traffic_full` è¡¨ã€‚
- `app.py` & `static/`: **çœ‹æ¿**. åŸºäº Flask + Chart.js çš„é«˜æ€§èƒ½äº¤äº’å¼å›¾è¡¨ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **ç¯å¢ƒå®‰è£…**:

   ```bash
   pip install flask pandas requests lxml holidays openmeteo-requests requests-cache retry-requests python-dateutil
   ```

2. **æ•°æ®ç®¡çº¿è·‘é€š**:

   ```bash
   python build_tsa_db.py        # 1. æŠ“å®¢æµ
   python add_features.py        # 2. ç®—å‡æ—¥
   python get_weather_features.py # 3. ç®—å¤©æ°”
   python merge_db.py            # 4. åˆå¹¶å®½è¡¨
   ```

3. **å¯åŠ¨çœ‹æ¿**:
   ```bash
   python app.py
   # è®¿é—® http://127.0.0.1:5000
   ```

## ğŸ”® æœªæ¥è·¯çº¿å›¾ (Roadmap)

ä¸ºäº†è¿›ä¸€æ­¥é€¼è¿‘ 99.9% çš„é¢„æµ‹ç²¾åº¦ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€é˜¶æ®µå°†å…³æ³¨ä»¥ä¸‹â€œéšå½¢å¤§ BOSSâ€ï¼š

- [ ] **è¶…çº§ç¢— (Super Bowl)**: 2 æœˆæœ€å¼ºå•å‘å®¢æµäº‹ä»¶ã€‚
- [ ] **æ¯äº²èŠ‚ (Mother's Day)**: 5 æœˆå…¨å®¶å‡ºè¡Œé«˜å³°ã€‚
- [ ] **å¼€å­¦å­£ (Back to School)**: 8 æœˆæŒç»­æ€§å®¢æµçˆ¬å¡ã€‚
- [ ] **æ¨¡å‹æ¥å…¥**: æ­£å¼å¼•å…¥ Prophet æˆ– XGBoost æ¶ˆè€— `traffic_full` æ•°æ®ã€‚

---

_Mikon AI Army Engineer Division_
