<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSA 旅客吞吐量历史数据</title>
    <!-- 引入外部样式 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- 依赖库 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <!-- Annotation Plugin (关键: 必须引入) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/3.0.1/chartjs-plugin-annotation.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>TSA 旅客吞吐量 - Mikon AI Scout</h1>
        
        <div class="controls">
            <!-- 快捷按钮 -->
            <button onclick="setQuickRange(365)" class="active">最近1年</button>
            <button onclick="setQuickRange(180)">最近半年</button>
            <button onclick="setQuickRange(30)">最近30天</button>
            
            <div class="divider"></div>

            <!-- 年份筛选 -->
            <select id="yearSelect">
                <!-- JS 动态填充 -->
            </select>

            <button onclick="chart.resetZoom()" style="margin-left: 20px;">重置缩放</button>
        </div>

        <div class="chart-container">
            <canvas id="trafficChart"></canvas>
        </div>
        <p class="hint">🖱️ 提示：点击红点查看详情 | 滚轮缩放 | 拖拽平移</p>

        <!-- 统计面板 (IDs 必须与 dashboard.js 一致) -->
        <div class="stats-panel" style="display: flex; justify-content: space-around; margin-top: 20px; text-align: center;">
            <div class="stat-card">
                <h3>最新客流 (<span id="latestDate">-</span>)</h3>
                <div class="value" id="latestPassengers" style="font-size: 1.5em; font-weight: bold; color: #007bff;">-</div>
            </div>
            <div class="stat-card">
                <h3>前日客流 (<span id="prevDate">-</span>)</h3>
                <div class="value" id="prevPassengers" style="font-size: 1.5em; font-weight: bold; color: #6c757d;">-</div>
            </div>
            <div class="stat-card" style="border: 2px solid #28a745; background: #f0fff4; min-width: 250px;">
                <h3>
                    预测客流 
                    <select id="predDateSelect" style="font-size: 0.8em; padding: 2px; margin-left: 5px; border-radius: 4px; border: 1px solid #ccc;">
                        <option value="">Loading...</option>
                    </select>
                </h3>
                <div class="value" id="predPassengers" style="font-size: 1.5em; font-weight: bold; color: #28a745;">Loading...</div>
            </div>
        </div>

        <!-- 预测回测表格 -->
        <div class="review-panel" style="margin-top: 40px;">
            <h2 style="border-left: 5px solid #28a745; padding-left: 10px;">🛡️ 模型实战回测 (Model Accuracy Review)</h2>
            <div style="overflow-x: auto;">
                <table id="accuracyTable" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                    <thead>
                        <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                            <th style="padding: 12px; text-align: left;">日期</th>
                            <th style="padding: 12px; text-align: right;">真实客流</th>
                            <th style="padding: 12px; text-align: right;">AI 预测</th>
                            <th style="padding: 12px; text-align: right;">误差 (人数)</th>
                            <th style="padding: 12px; text-align: center;">准确度</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- JS 填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 引入外部逻辑 -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
